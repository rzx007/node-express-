!function(I){"use strict";var m=I.ht,u=m.Default,n=u.getInternal(),g=n.ui(),w=null,t="__segmentLengths",B="__lineTotalLength",h="__linePoints",c="__distance0",D="flow.count",_="flow.step",T="flow.element.max",p="flow.element.count",L="flow.element.min",j="flow.element.space",W="flow.element.autorotate",e="flow.element.background",o="flow.element.shadow.max",$="flow.element.shadow.min",l="flow.element.shadow.begincolor",s="flow.element.shadow.endcolor",Q="flow.element.shadow.visible",N="flow.element.image",C="flow",q=m.Math.Vector2,x=new q;new q,new q,m.List;var X=m.Default._edgeProtectMethod,S=X.getStraightLinePoints,V=function(I,h){for(var D=[],V=I.length,q=0;V>q;q++){var H=I[q];H._as&&(H=H._as);for(var F=H[0],b=1;b<H.length;b++)D.push([F,H[b]]),F=H[b]}for(var r=[],q=0;q<D.length;q++){var u=G(D[q][0],D[q][1],h);r.push(u)}return{distance:r,segments:D}},F=function(E,s,v){if(E){for(var m,q=V(E,s),U=q.distance,X=q.segments,D=1/0,M=null,p=0,i=U.length;i>p;p++){var j=U[p];j.z<D&&(m=p,D=j.z,M=j)}if(null==v&&(v=.1),M.z<v){for(var y=0,I=0;m>=I;I++)y+=u.getDistance(X[I][0],m>I?X[I][1]:M);return y}}},G=function(r,$,I){var n=r.x,i=r.y,L=$.x,H=$.y,B=I.x,G=I.y,Q=L-n,D=H-i,Y=Math.sqrt(Q*Q+D*D),u=Q/Y,q=D/Y,O=(-n+B)*u+(-i+G)*q,E={x:n+O*u,y:i+O*q};return E.x>=Math.min(r.x,$.x)&&E.x<=Math.max(r.x,$.x)&&E.y>=Math.min(r.y,$.y)&&E.y<=Math.max(r.y,$.y)||(E.x=Math.abs(E.x-r.x)<Math.abs(E.x-$.x)?r.x:$.x,E.y=Math.abs(E.y-r.y)<Math.abs(E.y-$.y)?r.y:$.y),Q=B-E.x,D=G-E.y,E.z=Math.sqrt(Q*Q+D*D),E},A=function(q,Z){if(q){var K=V(q,Z).distance,C=1/0,o=null;return K.forEach(function(u){u.z<C&&(C=u.z,o=u)}),o}},H=X.calculateLineLength,Z=X.calcSegmentIndexByDistance,i=X.calculatePointAlongLine,Y=function(O,P,v){if(!O)return v;if(0===P){var q=O[0][0],S=O[0][1];return v+Math.atan2(S.y-q.y,S.x-q.x)}if(100===P){O=O[O.length-1];var q=O[O.length-2],S=O[O.length-1];return v+Math.atan2(S.y-q.y,S.x-q.x)}for(var p=0,D=[],Y=O.length,w=0;Y>w;w++){var _=O[w],j=H(_);p+=j,D.push(j)}for(var z=p*P/100,L=Z(z,D),E=0,W=0;L>W;W++)E+=D[W];z-=E;for(var J=i(O[L],z),k=O[L],o=0,K=0,c=0;c<k.length-1;c++){var X=k[c],Q=k[c+1],l=Q.x-X.x,B=Q.y-X.y,C=Math.sqrt(l*l+B*B);if(o+=C,o>z){K=c;break}}var G=k[K];return v+Math.atan2(J.y-G.y,J.x-G.x)},y=function(I){var x=0;if(I)if(Array.isArray(I[0]))for(var A=I.length,W=0;A>W;W++){var r=I[W],d=H(r);x+=d}else x=H(I);return x},z=function(J,c,g,b){return x.set(c,g).rotateAround(null,b),J?{x:J.x+x.x,y:J.y+x.y}:{x:x.x,y:x.y}},b=function(w){var Z=w._data,p=S(w);if(p){Z.s("flow.reverse")&&(p.reverse(),p.forEach(function(X){X.reverse()}));for(var $=0,R=[],E=p.length,X=0;E>X;X++){var O=p[X],j=H(O);$+=j,R.push(j)}if(Z[t]=R,Z[B]=$,Z[h]=p,Z instanceof m.Edge){var n=u.unionPoint(p),z=n.x+n.width/2,o=n.y+n.height/2;Z.$10e={x:z,y:o}}v(w,!0)}},E=X.getPercentPosition,v=function(w,O){var g=w._data,f=g[B],o=g.s(D),Z=g.s(_),J=0,H=g[t],Q=g.s(T),u=g.s(L),K=g.s(p),k=(Q-u)/(K-1),M=[];if(H){if(1===K)M.push(Q);else if(2===K)M.push(Q),M.push(u);else{if(!(K>2))return;M.push(Q);for(var b=K-2;b>0;b--)M.push(u+k*b);M.push(u)}var I=0,m=0;M.forEach(function(u){K-1>I&&(m+=g.getFlowElementSpace(u)),I++}),m+=(Q+u)/2,J=(f-o*m+m)/o;var d=w[c];for(null==d&&(d=0),O||(d+=Z);d>f+m;){var v=w._overCount;v?v++:v=1,v>=o&&(v=null),w._overCount=v,g.s("flow.autoreverse")?v?d-=J+m:(d=0,g.s("flow.reverse",!g.s("flow.reverse"))):d-=J+m}w[c]=d}},R="prototype",M=m.graph.GraphView[R],P=m.Data[R],r=g.DataUI[R],O=g.ShapeUI[R],J=g.EdgeUI[R],k=m.DataModel[R],f=m.Style;f[T]==w&&(f[T]=7),f[L]==w&&(f[L]=0),f[D]==w&&(f[D]=1),f[_]==w&&(f[_]=3),f[p]==w&&(f[p]=10),f[j]==w&&(f[j]=3.5),f[W]==w&&(f[W]=!1),f[e]==w&&(f[e]="rgba(255, 255, 114, 0.4)"),f[l]==w&&(f[l]="rgba(255, 255, 0, 0.3)"),f[s]==w&&(f[s]="rgba(255, 255, 0, 0)"),f[Q]==w&&(f[Q]=1),f[o]==w&&(f[o]=22),f[$]==w&&(f[$]=4),M.calculatePointLength=function(P,f,q){var E=this.getDataUI(P),G=S(E);return F(G,f,q)},u.calculatePointLength=function(Q,q,h,x){var M=S(w,Q,q);return F(M,h,x)},u.calculateClosestPointOnLine=G,M.calculateClosestPoint=function(K,Y){var T=this.getDataUI(K),W=S(T);return A(W,Y)},u.calculateClosestPoint=function(D,F,M){var C=S(w,D,F);return A(C,M)},M.getPercentAngle=function(X,g){var e=this.getDataUI(X),V=S(e);return X.getRotation?X.getRotation():0,Y(V,g,X.getRotation?X.getRotation():0)},u.getPercentAngle=function(r,g,z){var c=S(w,r,g);return Y(c,z,0)},M.calculateLength=function(f){var _=this.getDataUI(f),H=S(_);return y(H)},u.calculateLength=function(K,W){var F=S(w,K,W);return y(F)},M.getPercentPosition=function(V,h){var d=this.getDataUI(V),r=S(d);return E(r,h)},u.getPercentPositionOnPoints=function(m,h,i){var T=S(w,m,h);return E(T,i)};var d=function(R){var H=R.data,l=this.dm();if(H&&"add"===R.kind){var S=l.$3e;S&&H.s(C)&&S.indexOf(H)<0&&S.push(H)}"clear"===R.kind&&(l.$3e=[])},K=function(u){var $=u.property,K=u.data,F=u.newValue,D=this.dm().$3e;if(D&&"s:flow"===$)if(F)D.indexOf(K)<0&&D.push(K);else for(var t=D.length,x=0;t>x;x++)if(D[x]===K){D.splice(x,1);break}},a=M.setDataModel;M.setDataModel=function($){var h=this,b=h._dataModel;if(b!==$){b&&(b.umm(d,h),b.umd(K,h),b.$3e=[]),$.mm(d,h),$.md(K,h);var Q=$.$3e=[];$.each(function(g){g.s(C)&&Q.indexOf(g)<0&&Q.push(g)}),a.call(h,$)}},P.getFlowElementSpace=function(){return this.s(j)};var U=function(K){var f=this,P=f._data,I=P[B],E=P[t],X=P[h],J=P.s(D),A=0,M=f[c],s=P.s(T),y=P.s(L),x=P.s(p),U=P.s($),G=P.s(o),d=P.s(W),R=(G-U)/(x-1),r=(s-y)/(x-1),O=P.getRotation?P.getRotation():0,e=P.getPosition?P.p():P.$10e,C=[],u=[];if(M!=w){if(1===x)C.push(s);else if(2===x)C.push(s),C.push(y);else{if(!(x>2))return;C.push(s);for(var N=x-2;N>0;N--)C.push(y+r*N);C.push(y)}if(1===x)u.push(G);else if(2===x)u.push(G),u.push(U);else{if(!(x>2))return;u.push(G);for(var N=x-2;N>0;N--)u.push(U+R*N);u.push(U)}var l=0,n=0;C.forEach(function(e){x-1>l&&(n+=P.getFlowElementSpace(e)),l++}),n+=(s+y)/2,A=(I-J*n+n)/J,K.save();for(var N=0;J>N;N++){var _=M,Y=0,g=f._overCount,m=0;P.s("flow.autoreverse")&&g&&g>J-(N+1)||(_-=N*(A+n),l=0,C.forEach(function(x){var c=_-Y;if(c>=0&&I>c){var $=!0,s=Z(c,E);m=0;for(var v=0;s>v;v++)m+=E[v];if(c-=m,$){var b=i(X[s],c),T=O;if(d){for(var r=X[s],y=0,G=0,S=0;S<r.length-1;S++){var Q=r[S],J=r[S+1],g=J.x-Q.x,a=J.y-Q.y,t=Math.sqrt(g*g+a*a);if(y+=t,y>c){G=S;break}}var N=r[G];T+=Math.atan2(b.y-N.y,b.x-N.x)}O&&(b=z(e,b.x-e.x,b.y-e.y,O)),f.$5e(K,b,x,u[l],T)}}Y+=P.getFlowElementSpace(C[l]),l++}))}K.restore()}},lh=J._80o;J._80o=function(s){lh.call(this,s);var r=this,G=r._data,A=r.gv;G.s(C)&&A.$7e!=w&&U.call(r,s)};var Po=O._80o;O._80o=function(M){Po.call(this,M);var y=this,P=y._data,j=y.gv;P.s(C)&&j.$7e!=w&&U.call(y,M)};var Ej=J._79o,Vb=O._79o,sj=function(){var l=this,V=l._data,q=V.s(T),M=!1,y=w;if(l._6I||(M=!0),y=V instanceof m.Edge?Ej.call(l):Vb.call(l),V.s(C)&&M){var k=V.s(o),X=V.s(Q);X&&k>q&&(q=k),q>0&&u.grow(y,Math.ceil(q/2)),b(l)}return!V.s(C)&&M&&(V[t]=V[B]=V[h]=l[c]=w),y};O._79o=sj,J._79o=sj,r.$5e=function(g,m,f,L,_){var W=this,O=W._data,X=W.gv,b=O.s(e),H=O.s(l),t=O.s(s),P=O.s(Q),x=X.$8e,v=O.s(N);if(x==w&&(x=X.$8e={}),g.beginPath(),v!=w){var q=u.getImage(v),o=f/2;g.translate(m.x,m.y),g.rotate(_),g.translate(-m.x,-m.y),u.drawImage(g,q,m.x-o,m.y-o,f,f,O),g.translate(m.x,m.y),g.rotate(-_),g.translate(-m.x,-m.y)}else if(X.__flowBatch){var Z=X.__flowBatchGroup;Z||(Z=X.__flowBatchGroup={});var D=[m.x,m.y,f/2];Z[b]?Z[b].push(D):Z[b]=[D]}else g.fillStyle=b,g.arc(m.x,m.y,f/2,0,2*Math.PI,!0),g.fill();if(P){var Y=22,z=Y+"_"+H+"_"+t,I=x[z];if(I==w){var c=document.createElement("canvas");n.setCanvas(c,Y,Y);var j=c.getContext("2d"),a=Y/2,S=a,B=a;n.translateAndScale(j,0,0,1),j.beginPath();var d=j.createRadialGradient(S,B,0,S,S,a);d.addColorStop(0,H),d.addColorStop(1,t),j.fillStyle=d,j.arc(S,B,a,0,2*Math.PI,!0),j.fill(),I=x[z]=c}var o=L/2;u.drawImage(g,I,m.x-o,m.y-o,L,L,O)}},M.$9e=function(){var i=this,Y=i.dm().$3e;i._24I,Y.forEach(function(p){i._24I[p._id]=p}),i.iv()};var Bg=k.prepareRemove;k.prepareRemove=function(W){Bg.call(this,W);var d=W._dataModel,o=d.$3e;if(o)for(var V=o.length,$=0;V>$;$++)if(o[$]===W){o.splice($,1);break}},M.setFlowInterval=function(i){var B=this,H=B.$11e;B.$11e=i,B.fp("flowInterval",H,i),B.$7e!=w&&(clearInterval(B.$7e),delete B.$7e,B.enableFlow(i))},M.getFlowInterval=function(){return this.$11e},M.enableFlow=function(s){var L=this,U=L.dm(),H=U.$3e;L.$7e==w&&(H.forEach(function(R){var m=L.getDataUI(R);b(m)}),L.$7e=setInterval(function(){U.$3e.forEach(function(k){v(L.getDataUI(k))}),L.$9e()},s||L.$11e||50))},M.disableFlow=function(){var f=this;clearInterval(f.$7e),delete f.$7e;var Z=f.dm().$3e;Z&&f.$9e()};var Dg=function(){this.__flowBatchGroup={}},xd=function(Y){var N=this.__flowBatchGroup;if(N){Y.save();for(var M in N){Y.fillStyle=M,Y.beginPath();var C=N[M];C.forEach(function($){Y.moveTo($[0],$[1]),Y.arc($[0],$[1],$[2],0,2*Math.PI,!0)}),Y.fill()}Y.restore()}};M.setFlowBatch=function(w){var y=this;!!y.__flowBatch!=!!w&&(y.__flowBatch=w,w?(y.addBottomPainter(Dg),y.addTopPainter(xd)):(y.removeBottomPainter(Dg),y.removeTopPainter(xd)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);